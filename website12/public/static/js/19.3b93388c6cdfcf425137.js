webpackJsonp([19,0],{"6WE5":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("T4f3"),i=n.n(a),o=n("gyMJ"),s=(n("aKwh"),{props:{boxShadow:{type:Boolean,default:!1},getValue:{type:Function},navigation:{type:Boolean,default:!0},toolbarsFlag:{type:Boolean,default:!1},defaultOpen:{type:String,default:"preview"},editable:{type:Boolean,default:!1},status:{type:String,default:"readArticle"},article_id:{type:String},toolbars:{type:Object,default:function(){return{bold:!0,italic:!0,header:!0,underline:!0,strikethrough:!0,mark:!0,superscript:!0,subscript:!0,quote:!0,ol:!0,ul:!0,link:!0,imagelink:!0,code:!0,table:!0,readmodel:!0,htmlcode:!0,help:!0,undo:!0,redo:!0,save:!0,navigation:!0,alignleft:!0,aligncenter:!0,alignright:!0,subfield:!0,preview:!0}}}},data:function(){return{value:"",articles:{},info:{}}},watch:{article_id:function(t){var e=this;"updateArticle"===this.status&&o.a.getArticleById({article_id:this.article_id}).then(function(t){t.code&&(e.value=t.data)}).catch(function(t){console.log(t)})},value:function(t){this.getValue&&this.getValue(t)}},mounted:function(){var t=this;"updateArticle"===this.status&&o.a.getArticleById({article_id:this.article_id}).then(function(e){e.code&&(t.value=e.data)}).catch(function(t){console.log(t)}),"read"===this.status&&o.a.getArticleById({article_id:this.$route.params.article_id}).then(function(e){if(e.code){var n=e.data.replace(/#.+\n/,"");t.value=n,t.articles[t.$route.params.article_id]=n,t.info[t.$route.params.article_id]=e.info,t.$emit("getArticle",e.info)}}).catch(function(t){console.log(t)})},computed:{},methods:{$imgAdd:function(t,e){var n=this;o.a.uploadArticleImg(i()({},e)).then(function(a){a.code&&(n.value=n.value.replace("!["+e._name+"]("+t+")","!["+e._name+"]("+a.data+")"))}).catch(function(t){console.log(t)})}},activated:function(){var t=this;if(this.value="",this.articles[this.$route.params.article_id]&&this.articles[this.$route.params.article_id].length>0)return this.value=this.articles[this.$route.params.article_id],void this.$emit("getArticle",this.info[this.$route.params.article_id]);"readArticle"===this.status&&o.a.getArticleById({article_id:this.$route.params.article_id}).then(function(e){e.code&&(t.value=e.data,t.articles[t.$route.params.article_id]=e.data)}).catch(function(t){console.log(t)}),"read"===this.status&&o.a.getArticleById({article_id:this.$route.params.article_id}).then(function(e){if(e.code){var n=e.data.replace(/#.+\n/,"");t.value=n,t.articles[t.$route.params.article_id]=n,t.info[t.$route.params.article_id]=e.info,t.$emit("getArticle",e.info)}}).catch(function(t){console.log(t)})}}),c={render:function(){var t=this,e=t.$createElement;return(t._self._c||e)("mavon-editor",{staticClass:"readStyle",attrs:{toolbarsFlag:t.toolbarsFlag,defaultOpen:t.defaultOpen,editable:t.editable,subfield:!1,navigation:t.navigation,toolbars:t.toolbars,boxShadow:t.boxShadow},on:{imgAdd:t.$imgAdd},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})},staticRenderFns:[]};var r=n("/4AN")(s,c,!1,function(t){n("ulf9")},"data-v-4a84f7ea",null);e.default=r.exports},"6orE":function(t,e,n){(function(t){var a=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new o(i.call(setTimeout,a,arguments),clearTimeout)},e.setInterval=function(){return new o(i.call(setInterval,a,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(a,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n("qrAv"),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(e,n("h6ac"))},LNoq:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("mYpx"),i=n.n(a),o=n("T4f3"),s=n.n(o),c=(n("6WE5"),n("fOL2")),r=(n("aKwh"),n("gyMJ")),l=n("6orE"),m={data:function(){return{content:"",name:"",email:"",recontent:"",comments:{},comment:[],isShow:!1,index:"",token:sessionStorage.getItem("token")}},mounted:function(){var t=this,e=this.$route.params.article_id;this.comments[e]?this.comment=this.comments[e]:r.a.getCommentsById({article_id:e}).then(function(n){n.code&&(t.comments[e]=n.data,t.comment=n.data,t.comment.forEach(function(e){e.icon=t.Icon()}))}).catch(function(t){console.log(t)})},activated:function(){var t=this,e=this.$route.params.article_id;this.comments[e]?this.comment=this.comments[e]:r.a.getCommentsById({article_id:e}).then(function(n){n.code&&(t.comments[e]=n.data,t.comment=n.data)}).catch(function(t){console.log(t)})},computed:{Comment:function(){return this.comment.sort(function(t,e){return e.comment_create_time-t.comment_create_time}),this.comment}},methods:{Icon:function(){var t=["#icon-default14","#icon-default13","#icon-default12","#icon-default11","#icon-default10","#icon-default9","#icon-default8","#icon-default7","#icon-default6","#icon-default5","#icon-default4","#icon-default3","#icon-default2","#icon-default1","#icon-default","#icon-icon-test9","#icon-icon-test5","#icon-icon-test2","#icon-icon-test3","#icon-icon-test4"];return t[Math.round(Math.random()*(t.length-1))]},reply:function(t){this.$store.state.token&&window.sessionStorage.getItem("token")&&this.$store.state.token===window.sessionStorage.getItem("token")?this.index?this.index="":this.index=t:alert("只有管理员有权限回复!")},agree:function(t){var e=this,n=void 0;n||(n=Object(l.setTimeout)(function(){n=null,r.a.toAgree({id:t}).then(function(n){n.code?e.comment[e.comment.findIndex(function(e){return e.id===t})].comment_agree++:alert("点赞失败")}).catch(function(t){console.log(t)})},1500))},toComment:function(){var t=this;if(this.name.length>30)this.$notify.warning({message:"昵称太长了！",offset:150});else if(this.content.length>530)this.$notify.warning({message:"内容太长了！",offset:150});else{if(""!==this.email&&!/^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/.test(this.email))return this.$notify.warning({message:"邮箱格式不正确",offset:150}),void(this.email="");if(""===this.name||""===this.content)this.$notify.warning({message:"昵称和内容不能为空！",offset:150});else{var e={id:Object(c.a)(),article_id:this.$route.params.article_id,comment_name:this.name,comment_content:this.content,comment_email:this.email,comment_create_time:+new Date,comment_touxiang:this.Icon()};r.a.toComment(e).then(function(n){n.code?(t.comment.unshift(s()({},e,{parent_id:"",comment_agree:0})),t.comments[t.$route.params.article_id]=t.comment,t.content="",t.name="",Object(l.setTimeout)(function(){Array.prototype.forEach.call(document.querySelectorAll(".comments-item"),function(t){t.dataset.id===e.id&&(t.style.borderBottom="3px solid #2098D1")})},0)):alert(n.msg)}).catch(function(t){console.log(t)})}}},toReply:function(t){var e=this;if(""!==this.recontent){var n={id:Object(c.a)(),parent_id:t,article_id:this.$route.params.article_id,comment_name:this.$store.state.username,comment_content:this.recontent,comment_email:"",comment_create_time:+new Date,comment_touxiang:"#icon-default"};r.a.toComment(n).then(function(t){t.code&&(e.comment=[s()({},n,{comment_agree:0})].concat(i()(e.comment)),e.index="")}).catch(function(t){console.log(t)})}else this.$notify.warning({message:"回复内容不能为空",offset:150})},deleteComment:function(t){var e=this;confirm("确认删除？")&&r.a.deleteComment({id:t}).then(function(n){n.code?e.comment.splice(e.comment.findIndex(function(e){return e.id===t}),1):alert(n.msg)}).catch(function(t){console.log(ｅ)})}},filters:{formatDate:function(t){var e=+new Date-parseInt(t),n="";return e<=6e4?n="刚刚":6e4<e&&e<=36e5?n=Math.round(e/6e4)+"分钟前":36e5<e&&e<=864e5?n=Math.round(e/36e5)+"小时前":864e5<e&&e<=864e7&&(n=Math.round(e/864e5)+"天前"),n}}},d={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comments"},[n("h3",{staticClass:"comments-title"},[t._v("评论")]),t._v(" "),n("div",{staticClass:"comment-input-all"},[n("div",{staticClass:"comments-input"},[n("el-input",{staticClass:"comments-name",attrs:{placeholder:"昵称"},model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),t._v(" "),n("el-input",{staticClass:"comments-email",attrs:{placeholder:"请输入你的邮箱"},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}})],1),t._v(" "),n("div",{staticClass:"comments-content"},[n("el-input",{staticClass:"textarea",attrs:{type:"textarea",autosize:{minRows:3,maxRows:7},placeholder:"请输入评论",resize:"none",clearable:!0},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1)]),t._v(" "),n("el-button",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"primary",plain:""},on:{click:function(e){return e.stopPropagation(),t.toComment(e)}}},[t._v("评论")]),t._v(" "),n("div",{staticClass:"comments-all"},t._l(t.Comment,function(e){return""===e.parent_id?n("div",{key:e.id,staticClass:"comments-item",attrs:{"data-id":e.id}},[n("div",{staticClass:"item-main"},[n("div",{staticClass:"item-left"},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":e.comment_touxiang}})])]),t._v(" "),n("div",{staticClass:"item-right"},[n("span",{staticClass:"item-name"},[t._v(t._s(e.comment_name))]),t._v("\n                           "),t.token&&t.$store.state.token===t.token?n("el-button",{attrs:{type:"text"},on:{click:function(n){n.stopPropagation(),t.deleteComment(e.id)}}},[t._v("删除评论")]):t._e(),t._v(" "),n("pre",{staticClass:"item-content"},[t._v(t._s(e.comment_content)+"\n")]),t._v(" "),n("div",{staticClass:"item-bottom"},[n("span",{staticClass:"item-time"},[t._v(t._s(t._f("formatDate")(e.comment_create_time)))]),t._v(" "),n("span",{staticClass:"item-reply",on:{click:function(n){n.stopPropagation(),t.reply(e.id)}}},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#icon-huifu"}})])]),t._v(" "),n("span",{staticClass:"item-agree",on:{"~click":function(n){n.stopPropagation(),t.agree(e.id)}}},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#icon-dianzan"}})]),t._v(" "),n("span",{staticClass:"agree-num"},[t._v(t._s(e.comment_agree))])])]),t._v(" "),e.id===t.index?n("el-input",{staticStyle:{margin:"10px 0",width:"80%"},attrs:{type:"textarea",rows:2,placeholder:"请输入内容"},model:{value:t.recontent,callback:function(e){t.recontent=e},expression:"recontent"}}):t._e(),t._v(" "),e.id===t.index?n("div",{staticClass:"reply-btn"},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){n.stopPropagation(),t.toReply(e.id)}}},[t._v("评论")])],1):t._e(),t._v(" "),t._l(t.comment,function(a){return""!==a.parent_id&&a.parent_id===e.id?n("div",{key:a.id+Math.random(),staticClass:"reply"},[n("div",{staticClass:"reply-left"},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#icon-icon-test8"}})])]),t._v(" "),n("div",{staticClass:"reply-right"},[n("span",{staticClass:"reply-name",staticStyle:{color:"red"}},[t._v(t._s(a.comment_name))]),t._v("\n                                回复　"),n("span",{staticStyle:{color:"#2098D1"}},[t._v(t._s(e.comment_name))]),t._v(" ：\n"),n("pre",{staticClass:"reply-content"},[t._v(t._s(a.comment_content)+"\n")]),t._v(" "),n("div",{staticClass:"reply-bottom"},[n("span",{staticClass:"reply-time"},[t._v(t._s(t._f("formatDate")(a.comment_create_time)))]),t._v(" "),t.token&&t.$store.state.token===t.token?n("el-button",{attrs:{type:"text"},on:{click:function(e){e.stopPropagation(),t.deleteComment(a.id)}}},[t._v("删除评论")]):t._e(),t._v(" "),n("span",{staticClass:"reply-agree",on:{"~click":function(e){e.stopPropagation(),t.agree(a.id)}}},[n("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[n("use",{attrs:{"xlink:href":"#icon-dianzan"}})]),t._v(" "),n("span",{staticClass:"agree-num"},[t._v(t._s(a.comment_agree))])])],1)])]):t._e()})],2)])]):t._e()}))],1)},staticRenderFns:[]};var u=n("/4AN")(m,d,!1,function(t){n("rHk+")},"data-v-649fc336",null);e.default=u.exports},qrAv:function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var a,i,o,s,c,r=1,l={},m=!1,d=t.document,u=Object.getPrototypeOf&&Object.getPrototypeOf(t);u=u&&u.setTimeout?u:t,"[object process]"==={}.toString.call(t.process)?a=function(t){e.nextTick(function(){h(t)})}:!function(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?((o=new MessageChannel).port1.onmessage=function(t){h(t.data)},a=function(t){o.port2.postMessage(t)}):d&&"onreadystatechange"in d.createElement("script")?(i=d.documentElement,a=function(t){var e=d.createElement("script");e.onreadystatechange=function(){h(t),e.onreadystatechange=null,i.removeChild(e),e=null},i.appendChild(e)}):a=function(t){setTimeout(h,0,t)}:(s="setImmediate$"+Math.random()+"$",c=function(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(s)&&h(+e.data.slice(s.length))},t.addEventListener?t.addEventListener("message",c,!1):t.attachEvent("onmessage",c),a=function(e){t.postMessage(s+e,"*")}),u.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var i={callback:t,args:e};return l[r]=i,a(r),r++},u.clearImmediate=f}function f(t){delete l[t]}function h(t){if(m)setTimeout(h,0,t);else{var e=l[t];if(e){m=!0;try{!function(t){var e=t.callback,a=t.args;switch(a.length){case 0:e();break;case 1:e(a[0]);break;case 2:e(a[0],a[1]);break;case 3:e(a[0],a[1],a[2]);break;default:e.apply(n,a)}}(e)}finally{f(t),m=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(e,n("h6ac"),n("pBGv"))},"rHk+":function(t,e){},ulf9:function(t,e){}});
//# sourceMappingURL=19.3b93388c6cdfcf425137.js.map